(this["webpackJsonpgraphic-editor"]=this["webpackJsonpgraphic-editor"]||[]).push([[0],{15:function(e,n,t){e.exports=t(35)},20:function(e,n,t){},21:function(e,n,t){e.exports=t.p+"static/media/logo.5d5d9eef.svg"},28:function(e,n){},29:function(e,n){},30:function(e,n){},31:function(e,n,t){},34:function(e,n,t){},35:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),o=t(6),c=t.n(o),i=(t(20),t(21),t(3)),l=t.n(i),s=t(7),u=t(8),d=t(9),f=t(13),v=t(14),m=t(2),h=new m.fabric.Canvas,y=t(10),p=t(37),g=t(38),E=t(39),b=t(40);t(31);function k(e){return new Promise((function(n,t){var a=new FileReader;a.readAsDataURL(e),a.onload=function(){return n(a.result)},a.onerror=function(e){return t(e)}}))}var L=function(e,n){return function(e,n,t){return e>=n&&e<=t}(n,0,e.size-1)};function w(e,n,t){if(!L(e,n)||!L(e,t))return e;var a=e.get(n),r=e.get(t);return e.set(n,r).set(t,a)}var x=0,O=function(e){Object(v.a)(t,e);var n=Object(f.a)(t);function t(e){var o;return Object(u.a)(this,t),(o=n.call(this,e)).canvas=null,o.uploaderRef=Object(a.createRef)(null),o.state={layers:Object(y.a)(),mounted:!1,activeIndex:-1},o.addLayers=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x++;Object.defineProperty(e,"name",{value:n});var t=o.state.layers,a=t.push(e),r=a.findKey((function(e){return e.name===n}));o.setState({activeIndex:r,layers:a})},o.removeLayer=function(e){var n=o.state.layers,t=n.remove(n.findKey((function(n){return n===e})));o.setState({layers:t})},o.onShapeSelect=function(e){var n=o.state.layers;o.setState({activeIndex:n.findKey((function(n){return n.name===e}))})},o.onAddRectangle=function(){var e=new m.fabric.Rect({left:100,top:50,fill:"#"+Math.floor(16777215*Math.random()).toString(16),width:200,height:100,objectCaching:!1,hasRotatingPoint:!0}),n="rect_".concat(x++);e.on("selected",(function(){return o.onShapeSelect(n)})),h.add(e),h.setActiveObject(e),o.addLayers(e,n)},o.onUploadImage=function(e){o.uploaderRef.current.click()},o.onUploaderChange=function(){var e=Object(s.a)(l.a.mark((function e(n){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.target.files[0],e.next=3,k(t);case 3:a=e.sent,m.fabric.Image.fromURL(a,(function(e){var n=t.name;e.set({left:100,top:100,scaleX:.25,scaleY:.25}),e.on("selected",(function(){return o.onShapeSelect(n)})),h.add(e),h.setActiveObject(e),o.addLayers(e,t.name)}));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),o.onEditorKeyDown=function(e){if("Delete"===e.key&&o.state.mounted){var n=h.getActiveObject();h.remove(n),o.removeLayer(n)}},o.onDragLayer=function(e){console.log("onDragLayer",e)},o.handleLayerMovement=function(e){return function(n){console.log("onLayerMove",n),n.stopPropagation();var t=o.state,a=t.layers,r=t.activeIndex,c=a.get(r),i="top"===e?function(e,n){var t=e.indexOf(n);return t<0?e:e.delete(t).insert(e.size-1,n)}(a,c):"bottom"===e?function(e,n){var t=e.indexOf(n);return t<0?e:e.delete(t).insert(0,n)}(a,c):"up"===e?function(e,n){var t=e.indexOf(n);return t<0?e:w(e,t,t+1)}(a,c):"down"===e?function(e,n){var t=e.indexOf(n);return t<0?e:w(e,t,t-1)}(a,c):a;console.log("change direction",e);var l=i.findKey((function(e){return e===c}));console.log("activeIndex",l,"oldIndex",a.findKey((function(e){return e===c}))),o.setState({activeIndex:l,layers:i}),i.forEach((function(e,n){h.moveTo(e,n)}))}},o.handleLayerClick=function(e){return function(n){var t=o.state.layers;console.log("selected layer:",e);var a=t.findKey((function(n){return n===e}));console.log("key",a),o.setState({activeIndex:a}),h.setActiveObject(e),h.renderAll()}},o.renderLayers=function(){var e=o.state,n=e.layers,t=e.activeIndex;return r.a.createElement("div",{className:"layers"},r.a.createElement("p",null,"Layers:"),n.map((function(e,n){return r.a.createElement("div",{className:"layer ".concat(t===n?"active":""),key:e.name,onClick:o.handleLayerClick(e)},r.a.createElement("p",null,n,": ",e.name))})).reverse())},document.addEventListener("keydown",o.onEditorKeyDown),o}return Object(d.a)(t,[{key:"componentDidMount",value:function(){console.dir(this.canvas),console.log("instance",h),h.initialize(this.canvas,{preserveObjectStacking:!0,width:800,height:600}),this.setState({mounted:!0}),console.log(h)}},{key:"componentWillUnmount",value:function(){this.setState({mounted:!1})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"editor"},r.a.createElement("button",{onClick:this.onUploadImage},"Upload Image"),r.a.createElement("input",{type:"file",style:{display:"none"},accept:".jpg,.jpeg,.svg,.png",onChange:this.onUploaderChange,ref:this.uploaderRef}),r.a.createElement("button",{onClick:this.onAddRectangle},"Add Rect"),r.a.createElement("div",{className:"main-panel"},r.a.createElement("canvas",{ref:function(n){return e.canvas=n},style:{border:"1px solid #ccc"}}),r.a.createElement("div",{className:"right"},r.a.createElement("div",{className:"layer-actions"},r.a.createElement("p",null,"Layer Actions"),r.a.createElement(p.a,{onClick:this.handleLayerMovement("top")}),r.a.createElement(g.a,{onClick:this.handleLayerMovement("up")}),r.a.createElement(E.a,{onClick:this.handleLayerMovement("down")}),r.a.createElement(b.a,{onClick:this.handleLayerMovement("bottom")})),this.renderLayers())))}}]),t}(a.Component);t(34);var j=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(O,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[15,1,2]]]);
//# sourceMappingURL=main.4ddb8ec7.chunk.js.map